/*!
 * jQuery sumimark plugin
 *
 * @version 1.0.0
 * @author Hiroyuki OHARA <Hiroyuki.no22@gmail.com>
 * @copyright (c) 2013 Hiroyuki OHARA
 * @see https://github.com/no22/jquery-sumimark
 * @license MIT
 */
!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)}(function($){var timer=!1;$.fn.sumimark=function(options){if("string"!=typeof options){var settings=$.extend(!0,{boxClass:"sumi-box",imgClass:"sumi-img",markClass:"sumi-mark",textClass:"sumi-text",flagClass:"sumi-flag",mark:"æ¸ˆ",boxCss:{position:"relative",display:"block"},imgCss:{},markCss:{"border-width":0,"border-color":"red","border-style":"solid",color:"red"},bgcolor:"white",opacity:.5,rotate:15,border:!0,factor:.8,borderFactor:.05,sumiFactor:1.2,delay:0},options),results=$(this).each(function(){var $this=$(this),rotateStyle=!1,repl=$("<span />").addClass(settings.boxClass).css($.extend({"background-color":settings.bgcolor},settings.boxCss)),sumi=$this.clone(!0).addClass(settings.imgClass).css(settings.imgCss),mark=$("<span />").addClass(settings.markClass);if(repl.data({imgClass:settings.imgClass,markClass:settings.markClass,textClass:settings.textClass,flagClass:settings.flagClass,border:settings.border,factor:settings.factor,borderFactor:settings.borderFactor,sumiFactor:settings.sumiFactor}).attr("data-sumimark","sumimark"),settings.rotate){var r="rotate("+settings.rotate+"deg)";rotateStyle={transform:r,"-moz-transform":r,"-webkit-transform":r,"-o-transform":r,"-ms-transform":r}}if(sumi.css({opacity:settings.opacity,filter:"alpha(opacity="+100*settings.opacity+")"}),mark.css($.extend(settings.markCss,{position:"absolute"})),"string"==typeof settings.mark)if(mark.addClass(settings.flagClass),settings.border){mark.css({"border-radius":"50%","-webkit-border-radius":"50%","-moz-border-radius":"50%","box-sizing":"border-box","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box"});var txt=$("<span />").addClass(settings.textClass).css({position:"absolute"}).html(settings.mark);mark.append(txt)}else mark.html(settings.mark);else mark.append(settings.mark.clone().css({width:"100%",height:"100%"}));rotateStyle&&mark.css(rotateStyle),repl.append(sumi),repl.append(mark),$this.replaceWith(repl)});return timer&&clearTimeout(timer),timer=setTimeout(function(){$.sumimark("redraw")},settings.delay),results}return"redraw"===options?$(this).each(function(){var $this=$(this),settings=$this.data(),boxOffset=$this.offset(),sumi=$this.find("."+settings.imgClass),w=sumi.width(),h=sumi.height(),m=h>w?w:h,offset=sumi.offset(),s=Math.round(m*settings.factor),mark=$this.find("."+settings.markClass),flag=mark.hasClass(settings.flagClass);if(mark.css({width:s+"px",height:s+"px",top:offset.top-boxOffset.top+(h/2-s/2)+"px",left:offset.left-boxOffset.left+(w/2-s/2)+"px"}),flag&&(mark.css({"font-size":s+"px","line-height":s+"px"}),settings.border)){var circleWidth=Math.round(s*settings.borderFactor);mark.css({"border-width":circleWidth+"px"});var txt=mark.find("."+settings.textClass),is=s-2*circleWidth,sw=Math.round(.707*is*settings.sumiFactor);txt.css({"font-size":sw+"px","line-height":sw+"px",width:sw+"px",height:sw+"px",top:(s-sw)/2-circleWidth+"px",left:(s-sw)/2-circleWidth+"px"})}}):void 0},$.sumimark=function(options){return $("*[data-sumimark=sumimark]").sumimark(options)},$(window).bind("resize.sumimark",function(){$.sumimark("redraw")})});